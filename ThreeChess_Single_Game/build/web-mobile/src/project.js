window.__require=function s(t,e,i){function n(o,c){if(!e[o]){if(!t[o]){var a=o.split("/");if(a=a[a.length-1],!t[a]){var r="function"==typeof __require&&__require;if(!c&&r)return r(a,!0);if(h)return h(a,!0);throw new Error("Cannot find module '"+o+"'")}}var u=e[o]={exports:{}};t[o][0].call(u.exports,function(s){return n(t[o][1][s]||s)},u,u.exports,s,t,e,i)}return e[o].exports}for(var h="function"==typeof __require&&__require,o=0;o<i.length;o++)n(i[o]);return n}({ArrayExtation:[function(s,t,e){"use strict";cc._RF.push(t,"d5dde6X5KVPvappiaQV9Yjq","ArrayExtation"),Array.prototype.contains=function(s){for(var t=0;t<this.length;t++)if(this[t]==s)return!0;return!1},Array.prototype.delete=function(s){var t=this.indexOf(s);return-1!=t&&this.splice(t,1),this},cc._RF.pop()},{}],Chess:[function(s,t,e){"use strict";cc._RF.push(t,"92853RWg8BE3I2gKPW6og/w","Chess");cc.Class({extends:cc.Component,properties:{ChessImage:cc.Sprite,ChessSprite:[cc.SpriteFrame],HighLightSprite:[cc.SpriteFrame],SmallWhiteDot:cc.Node,_point:null,Point:{get:function(){return this._point},set:function(s){this._point=s}},IsBlack:!0,SrcPos:null,IsCurrentFlag:{set:function(s){this.SmallWhiteDot.active=s}}},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchChess,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onMoveChess,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onMoveEnd,this)},InitChess:function(s,t){this.IsBlack=s,this.ChessImage.spriteFrame=s?this.ChessSprite[0]:this.ChessSprite[1],this.IsCurrentFlag=t},Flash:function(){this.ChessImage.spriteFrame=this.IsBlack?this.HighLightSprite[0]:this.HighLightSprite[1],this.node.getComponent(cc.Animation).play()},StopFlash:function(){this.ChessImage.spriteFrame=this.IsBlack?this.ChessSprite[0]:this.ChessSprite[1],this.node.getComponent(cc.Animation).stop(),this.node.opacity=255},onTouchChess:function(s){{if(window.GameController.GameState==CommonDefine.GameStateEnum.MoveChess&&this.IsBlack==window.GameController.IsBlackTurn)return window.GameController.NewChess.IsCurrentFlag=!1,this.IsCurrentFlag=!0,void(window.GameController.NewChess=this);window.GameController.GameState==CommonDefine.GameStateEnum.EatChess&&this.IsBlack==!window.GameController.IsBlackTurn&&window.GameController.EatChess(this.node)}},onMoveChess:function(s){},onMoveEnd:function(s){}}),cc._RF.pop()},{}],CommonDefine:[function(s,t,e){"use strict";cc._RF.push(t,"73ecfc8q4FBPIv76iGjJiIm","CommonDefine");var i={GameStateEnum:{None:0,DropChess:1,PressChess:2,MoveChess:3,EatChess:4,End:5},PointTypeEnum:{Invalid:0,Empty:1,BlackChess:2,WhiteChess:3,DoubleChess:4}};window.CommonDefine=i,cc._RF.pop()},{}],GameScene:[function(s,t,e){"use strict";cc._RF.push(t,"c7b5c4wJlRBdKtgcREgq7W9","GameScene");var i=1,n=2,h=3,o=1,c=2,a=3,r=4,u=0,p=1,l=2;cc.Class({extends:cc.Component,properties:{ChessPrefab:cc.Prefab,MessageTextPrefab:cc.Prefab,RulePrefab:cc.Prefab,MessageBoxPref:cc.Prefab,Board:cc.Node,_gameState:0,GameState:{get:function(){return this._gameState},set:function(s){this._gameState=s}},IsBlackTurn:!0,ThreeTypeCount:0,ChessNodes:{default:[],visible:!1},HighLightThreePoints:{default:[],visible:!1},NewChess:{default:null,visible:!1},Notice:cc.Label,ColorStr:{get:function(){return this.IsBlackTurn?"\u84dd\u8272":"\u6a59\u8272"}},TurnNoticeStr:{get:function(){return"\u8f6e\u5230"+this.ColorStr+"\u8d70\u68cb"}}},start:function(){this.Board.on(cc.Node.EventType.TOUCH_START,this.onTouchBoard,this),this.Board.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),window.GameController=this,window.MessageBoxPref=this.MessageBoxPref,this.StartGame()},StartGame:function(){this.ChessPoints=[[1,0,0,1,0,0,1],[0,1,0,1,0,1,0],[0,0,1,1,1,0,0],[1,1,1,0,1,1,1],[0,0,1,1,1,0,0],[0,1,0,1,0,1,0],[1,0,0,1,0,0,1]],this.ThreePointsMap=new Map,this.PointsCanMovies=new Map;for(var s=0;s<this.ChessPoints.length;s++)for(var t=this.ChessPoints[s],e=0;e<t.length;e++){if(1==t[e]){var n=cc.v2(s,e);if(0==s||6==s){if(0==e||6==e){var h=0==s?1:-1,o=0==e?1:-1,c=[],a=[];c.push(cc.v2(s,3)),c.push(cc.v2(s,3+3*o)),a.push(c),(c=[]).push(cc.v2(3,e)),c.push(cc.v2(3+3*h,e)),a.push(c),(c=[]).push(cc.v2(s+1*h,e+1*o)),c.push(cc.v2(s+2*h,e+2*o)),a.push(c),this.ThreePointsMap.set(n,a);var r=[];h=0==s?1:-1,o=0==e?1:-1,r.push(cc.v2(s,3)),r.push(cc.v2(3,e)),r.push(cc.v2(s+1*h,e+1*o)),this.PointsCanMovies.set(n,r)}else if(3==e){var u=0==s?1:-1,p=[],l=[];p.push(cc.v2(s,0)),p.push(cc.v2(s,6)),l.push(p),(p=[]).push(cc.v2(s+1*u,3)),p.push(cc.v2(s+2*u,3)),l.push(p),this.ThreePointsMap.set(n,l);var C=[];u=0==s?1:-1,C.push(cc.v2(s,0)),C.push(cc.v2(s,6)),C.push(cc.v2(s+1*u,3)),this.PointsCanMovies.set(n,C)}}else if(1==s||5==s){if(1==e||5==e){var v=1==s?1:-1,f=1==e?1:-1,g=[],m=[];g.push(cc.v2(s,3)),g.push(cc.v2(s,3+2*f)),m.push(g),(g=[]).push(cc.v2(3,e)),g.push(cc.v2(3+2*v,e)),m.push(g),g=[],v=1==s?1:-1,f=1==e?1:-1,g.push(cc.v2(s+1*v,e+1*f)),g.push(cc.v2(s-1*v,e-1*f)),m.push(g),this.ThreePointsMap.set(n,m);var d=[];v=1==s?1:-1,f=1==e?1:-1,d.push(cc.v2(s,3)),d.push(cc.v2(3,e)),d.push(cc.v2(s+1*v,e+1*f)),v=1==s?-1:1,f=1==e?-1:1,d.push(cc.v2(s+1*v,e+1*f)),this.PointsCanMovies.set(n,d)}else if(3==e){var T=[],P=[];T.push(cc.v2(s,1)),T.push(cc.v2(s,5)),P.push(T),(T=[]).push(cc.v2(s-1,3)),T.push(cc.v2(s+1,3)),P.push(T),this.ThreePointsMap.set(n,P);var y=[];y.push(cc.v2(s,1)),y.push(cc.v2(s,5)),y.push(cc.v2(s+1,3)),y.push(cc.v2(s-1,3)),this.PointsCanMovies.set(n,y)}}else if(2==s||4==s){if(2==e||4==e){var S=2==s?1:-1,B=2==e?1:-1,M=[],N=[];M.push(cc.v2(s,3)),M.push(cc.v2(s,3+1*B)),N.push(M),(M=[]).push(cc.v2(s+1*S,e)),M.push(cc.v2(s+2*S,e)),N.push(M),M=[],S=2==s?-1:1,B=2==e?-1:1,M.push(cc.v2(s+1*S,e+1*B)),M.push(cc.v2(s+2*S,e+2*B)),N.push(M),this.ThreePointsMap.set(n,N);var E=[];S=2==s?-1:1,B=2==e?-1:1,E.push(cc.v2(s,3)),E.push(cc.v2(3,e)),E.push(cc.v2(s+1*S,e+1*B)),this.PointsCanMovies.set(n,E)}else if(3==e){var x=2==s?-1:1,w=[],I=[];w.push(cc.v2(s,2)),w.push(cc.v2(s,4)),I.push(w),(w=[]).push(cc.v2(s+1*x,3)),w.push(cc.v2(s+2*x,3)),I.push(w),this.ThreePointsMap.set(n,I);var k=[];x=2==s?-1:1,k.push(cc.v2(s,2)),k.push(cc.v2(s,4)),k.push(cc.v2(s+1*x,3)),this.PointsCanMovies.set(n,k)}}else if(3==s)if(0==e||6==e){var _=0==e?1:-1,G=[],F=[];G.push(cc.v2(3,e+1*_)),G.push(cc.v2(3,e+2*_)),F.push(G),(G=[]).push(cc.v2(0,e)),G.push(cc.v2(6,e)),F.push(G),this.ThreePointsMap.set(n,F);var O=[];_=0==e?1:-1,O.push(cc.v2(0,e)),O.push(cc.v2(6,e)),O.push(cc.v2(3,e+1*_)),this.PointsCanMovies.set(n,O)}else if(1==e||5==e){var R=[],L=[];R.push(cc.v2(3,e-1)),R.push(cc.v2(3,e+1)),L.push(R),(R=[]).push(cc.v2(1,e)),R.push(cc.v2(5,e)),L.push(R),this.ThreePointsMap.set(n,L);var D=[];D.push(cc.v2(3,e-1)),D.push(cc.v2(3,e+1)),D.push(cc.v2(s-2,e)),D.push(cc.v2(s+2,e)),this.PointsCanMovies.set(n,D)}else if(2==e||4==e){var H=2==e?-1:1,b=[],K=[];b.push(cc.v2(3,e+1*H)),b.push(cc.v2(3,e+2*H)),K.push(b),(b=[]).push(cc.v2(2,e)),b.push(cc.v2(4,e)),K.push(b),this.ThreePointsMap.set(n,K);var A=[];H=2==e?-1:1,A.push(cc.v2(3,e+1*H)),A.push(cc.v2(s-1,e)),A.push(cc.v2(s+1,e)),this.PointsCanMovies.set(n,A)}}}console.log("\u6240\u6709\u70b9\u7684\u6210\u4e09\u70b9",this.ThreePointsMap),console.log("\u70b9\u7684\u6240\u6709\u53ef\u79fb\u52a8\u70b9",this.PointsCanMovies),this.ResetGame(),this.GameState=i,this.ShowMessage(this.TurnNoticeStr)},ResetGame:function(){this.ChessNodes.length>0&&this.ChessNodes.forEach(function(s){s.destroy()}),this.ChessNodes=[],this.NewChess=null},StartButtonClick:function(){this.StartGame()},test:function(){MessageBox.show("\u84dd\u8272\u8d62\u4e86",MessageBox.OK)},Point2Position:function(s){return cc.v2((s.y-3)*(500/6),(3-s.x)*(500/6))},onTouchBoard:function(s){this.GameState},onTouchEnd:function(s){if(this.GameState==i||this.GameState==n||this.GameState==h){var t=s.getLocation(),e=this.node.parent.convertToWorldSpaceAR(t),u=this.Board.convertToNodeSpaceAR(e);if(this.GameState!=i){if(this.GameState==n){if(this.ThreeTypeCount>0){var p=this.IsBlackTurn?a:c,l=this.CheckPosInPoint(u,p);if(null!=l){this.ThreeTypeCount--,this.ChessPoints[l.x][l.y]=r;for(var C=0;C<this.ChessNodes.length;C++){var v=this.ChessNodes[C],f=v.getComponent("Chess").Point;if(f.x==l.x&&f.y==l.y){var g=cc.instantiate(this.ChessPrefab);g.parent=this.Board,g.getComponent("Chess").Point=l,g.getComponent("Chess").InitChess(this.IsBlackTurn,!1),g.position=this.Point2Position(l),3==l.x?(g.y+=8,v.y-=8):(g.x+=8,v.x-=8),this.ChessNodes.push(g);break}}if(this.ThreeTypeCount>0){var m=this.ColorStr+"\u8fd8\u53ef\u4ee5\u5403\u5bf9\u65b9"+this.ThreeTypeCount+"\u4e2a\u5b50";this.ShowMessage(m)}}}0==this.ThreeTypeCount&&(this.HighLightThreePoints.length>0&&(this.HighLightChesses(!1),this.HighLightThreePoints=[]),null!=this.NewChess&&(this.NewChess.IsCurrentFlag=!1),this.GameState=i,this.IsBlackTurn=!this.IsBlackTurn,this.ShowMessage(this.TurnNoticeStr)),this.CheckDropPhaseFinish()}else if(this.GameState==h){var d=this.CheckPosInPoint(u,CommonDefine.PointTypeEnum.Empty);if(null!=d)if(this.CheckCanMoveTo(this.NewChess.Point,d)){var T=this.Point2Position(d);this.NewChess.node.runAction(cc.moveTo(.3,T));var P=cc.v2(this.NewChess.Point.x,this.NewChess.Point.y);this.NewChess.Point=d,this.AfterMoveTo(P,d)}}}else{var y=this.CheckPosInPoint(u,o);if(null!=y){var S=cc.instantiate(this.ChessPrefab);S.parent=this.Board;var B=this.Point2Position(y);S.position=B,S.getComponent("Chess").InitChess(this.IsBlackTurn,!0),S.getComponent("Chess").Point=y,this.ChessNodes.push(S),this.ChessPoints[y.x][y.y]=this.IsBlackTurn?c:a,null!=this.NewChess&&(this.NewChess.IsCurrentFlag=!1),this.NewChess=S.getComponent("Chess"),this.CheckThree(y),this.ThreeTypeCount>0?this.GameState=n:(this.IsBlackTurn=!this.IsBlackTurn,this.ShowMessage(this.TurnNoticeStr),this.CheckDropPhaseFinish())}}}},CheckPosInPoint:function(s,t){var e=null;console.log("CheckPosInPoint,pressPos=",s);for(var i=0;i<this.ChessPoints.length;i++)for(var n=this.ChessPoints[i],h=0;h<n.length;h++){if(n[h]==t){var o=this.Point2Position(cc.v2(i,h));if(console.log("x=",i,",y=",h),Math.abs(o.x-s.x)<=500/6/2&&Math.abs(o.y-s.y)<=500/6/2)return e=cc.v2(i,h)}}return e},CheckCanMoveTo:function(s,t){var e=null;if(this.PointsCanMovies.forEach(function(t,i){s.x==i.x&&s.y==i.y&&(e=t)}),null==e||0==e.length)return!1;for(var i=0;i<e.length;i++)if(e[i].x==t.x&&e[i].y==t.y)return!0;return!1},AfterMoveTo:function(s,t){this.ChessPoints[t.x][t.y]=this.ChessPoints[s.x][s.y],this.ChessPoints[s.x][s.y]=CommonDefine.PointTypeEnum.Empty,this.CheckThree(t)>0?this.GameState=CommonDefine.GameStateEnum.EatChess:this.IsBlackTurn=!this.IsBlackTurn},CheckThree:function(s){var t=this,e=0;if(this.ThreePointsMap.forEach(function(i,n){s.x==n.x&&s.y==n.y&&i.forEach(function(i){var n=0;i.forEach(function(e){var i=t.ChessPoints[e.x][e.y];i!=c&&i!=a||i==t.ChessPoints[s.x][s.y]&&n++}),n==i.length&&(e++,i.forEach(function(s){-1==t.HighLightThreePoints.indexOf(s)&&t.HighLightThreePoints.push(s)}))})}),this.HighLightThreePoints.length>0&&(this.HighLightThreePoints.push(s),this.HighLightChesses(!0)),this.ThreeTypeCount=e,e>0){var i=this.ColorStr+"\u5f62\u6210\u4e86"+this.ThreeTypeCount+"\u4e2a\u4e09\u5b50,\u53ef\u4ee5\u5403\u6389\u5bf9\u65b9"+this.ThreeTypeCount+"\u4e2a\u68cb\u5b50";this.ShowMessage(i)}return e},HighLightChesses:function(s){var t=this;!this.HighLightThreePoints||this.HighLightThreePoints.length<=0||this.HighLightThreePoints.forEach(function(e){t.ChessNodes.forEach(function(t){var i=t.getComponent("Chess");i.Point.x==e.x&&i.Point.y==e.y&&(s?i.Flash():i.StopFlash())})})},CheckDropPhaseFinish:function(){if(this.IsBoardFull()){for(var s=0;s<this.ChessPoints.length;s++)for(var t=0;t<this.ChessPoints[s].length;t++){var e=this.ChessPoints[s][t],i=cc.v2(s,t);if(4==e){this.ChessPoints[s][t]=1;for(var n=0;n<this.ChessNodes.length;n++){var o=this.ChessNodes[n],c=o.getComponent("Chess").Point;c.x==i.x&&c.y==i.y&&(this.ChessNodes.delete(o),o.destroy())}}}this.GameState=h,this.IsBlackTurn=!1,this.ShowMessage(this.TurnNoticeStr)}},IsBoardFull:function(){for(var s=0;s<this.ChessPoints.length;s++)for(var t=0;t<this.ChessPoints[s].length;t++){if(1==this.ChessPoints[s][t])return!1}return!0},EatChess:function(s){if(this.GameState==CommonDefine.GameStateEnum.EatChess){var t=s.getComponent("Chess").Point;if(this.ChessPoints[t.x][t.y]=CommonDefine.PointTypeEnum.Empty,this.ChessNodes.delete(s),s.destroy(),this.JudgeWin()==u)if(this.ThreeTypeCount--,this.ThreeTypeCount>0){var e=this.ColorStr+"\u8fd8\u53ef\u4ee5\u5403\u5bf9\u65b9"+this.ThreeTypeCount+"\u4e2a\u5b50";this.ShowMessage(e)}else this.HighLightThreePoints.length>0&&(this.HighLightChesses(!1),this.HighLightThreePoints=[]),this.IsBlackTurn=!this.IsBlackTurn,this.ShowMessage(this.TurnNoticeStr),this.GameState=CommonDefine.GameStateEnum.MoveChess}},JudgeWin:function(){var s=0,t=0;this.ChessNodes.forEach(function(e){e.getComponent("Chess").IsBlack?s++:t++});var e=u;if(s<=2){MessageBox.show("\u6a59\u8272\u65b9\u8d62\u4e86",MessageBox.OK),e=l}else if(t<=2){MessageBox.show("\u84dd\u8272\u65b9\u8d62\u4e86",MessageBox.OK),e=p}return e!=u&&(this.GameState=CommonDefine.GameStateEnum.GameEnd),e},ShowMessage:function(s){this.Notice.string=s},OnRuleBtnClick:function(){cc.instantiate(this.RulePrefab).parent=this.node}}),cc._RF.pop()},{}],MessageDialog:[function(s,t,e){"use strict";cc._RF.push(t,"64436rDNylB0I+2iulhd7Aa","MessageDialog");var i={OK:0,OKCancel:1};i.StyleEnum=cc.Enum({OK:0,OKCancel:1}),i.ButtonStyle=cc.Enum({OK:0,CANCLE:1,RECONNECT:2,BACKLOGIN:3,GOUP:4,CONTINUE:5,GOSHOP:6,GOCHECK:7,DELAYGO:8}),i.show=function(s,t,e){var i=cc.instantiate(window.MessageBoxPref);i.parent=cc.find("Canvas"),i.zIndex=cc.macro.MAX_ZINDEX,i.getComponent("MessageDialog").show(s,t,e)},window.MessageBox=i,cc.Class({extends:cc.Component,properties:{okButton:{default:null,type:cc.Node},cancelButton:{default:null,type:cc.Node},oKImage:{default:null,type:cc.Sprite},cancelImage:{default:null,type:cc.Sprite},contentLabel:{default:null,type:cc.Label},ButtonTexts:{default:[],type:cc.SpriteFrame},LeftOKBtnNode:cc.Node,RightCancelBtnNode:cc.Node,CenterOKBtnNode:cc.Node,_style:-1,Style:{get:function(){return this._style},set:function(s){this._style=s,s==i.StyleEnum.OKCancel?(this.okButton.position=this.LeftOKBtnNode.position,this.okButton.active=!0,this.cancelButton.position=this.RightCancelBtnNode.position,this.cancelButton.active=!0):s==i.StyleEnum.OK&&(this.okButton.position=this.CenterOKBtnNode.position,this.okButton.active=!0,this.cancelButton.active=!1)}},__callBack:null},onLoad:function(){},show:function(s,t,e){this.Style=t,this.__callBack=e,this.contentLabel.string=s},onOKButtonClicked:function(){this.__callBack&&this.__callBack(!0),this.node.destroy()},onCancelButtonClicked:function(){this.__callBack&&this.__callBack(!1),this.node.destroy()}}),cc._RF.pop()},{}],MessageText:[function(s,t,e){"use strict";cc._RF.push(t,"af1d6MLLQhPUKVU5lO61EMv","MessageText"),cc.Class({extends:cc.Component,properties:{messageText:cc.Label,_waitText:"",_leftTime:0,_isOver:!1},setMsg:function(s,t){this.messageText.string=s;var e=cc.delayTime(2),i=this,n=cc.callFunc(function(){i.node.destroy()}),h=cc.fadeIn(.5);i.node.runAction(cc.sequence(h,e,n))}}),cc._RF.pop()},{}],Rule:[function(s,t,e){"use strict";cc._RF.push(t,"ba76dEvipBNNJ3BIEkV1yvX","Rule"),cc.Class({extends:cc.Component,properties:{RuleText:cc.RichText},Show:function(){},OnCloseButtonClick:function(){this.node.destroy()}}),cc._RF.pop()},{}]},{},["ArrayExtation","Chess","CommonDefine","GameScene","MessageDialog","MessageText","Rule"]);