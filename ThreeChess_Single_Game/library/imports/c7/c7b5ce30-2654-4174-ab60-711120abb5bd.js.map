{"version":3,"sources":["../../../../assets/scripts/assets/scripts/GameScene.js"],"names":["BoardWidth","width","CENTER","GameStateEnum","None","DropChess","PressChess","MoveChess","EatChess","GameEnd","PointTypeEnum","Invalid","Empty","BlackChess","WhiteChess","DoubleChess","WinOrLoseEnum","NotEndYet","BlackWin","WhiteWin","cc","Class","extends","Component","properties","ChessPrefab","Prefab","MessageTextPrefab","RulePrefab","MessageBoxPref","Board","Node","_gameState","GameState","get","set","value","IsBlackTurn","ThreeTypeCount","ChessNodes","default","visible","HighLightThreePoints","NewChess","Notice","Label","ColorStr","TurnNoticeStr","start","on","EventType","TOUCH_START","onTouchBoard","TOUCH_END","onTouchEnd","window","GameController","StartGame","ChessPoints","ThreePointsMap","Map","PointsCanMovies","i","length","line","j","ptValue","pt","v2","rowOffset","colOffset","oneLine","lines","push","moveis","console","log","ResetGame","ShowMessage","forEach","node","destroy","StartButtonClick","test","MessageBox","show","OK","Point2Position","pos","y","x","event","getLocation","worldPos","parent","convertToWorldSpaceAR","localPos","convertToNodeSpaceAR","CheckPosInPoint","chess","instantiate","position","getComponent","InitChess","Point","IsCurrentFlag","CheckThree","CheckDropPhaseFinish","type","pt2","tempPt","newChess","msg","HighLightChesses","point","CommonDefine","bCanMove","CheckCanMoveTo","centerPos","runAction","moveTo","prePt","AfterMoveTo","pressPos","needPointType","ptPos","Math","abs","srcPoint","dstPoint","movies","key","threeTypeCount","sameChessNum","indexOf","isFlash","Flash","StopFlash","IsBoardFull","k","delete","chessNode","endStatus","JudgeWin","blackCount","wihteCount","IsBlack","status","string","OnRuleBtnClick","rule"],"mappings":"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","file":"GameScene.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["const BoardWidth = 500;\nconst width = BoardWidth/6;\nconst CENTER = 3;//中心那个点\nconst GameStateEnum = {\n    None:0,\n    DropChess:1,\n    PressChess:2,\n    MoveChess:3,\n    EatChess:4,\n    GameEnd:5,\n};\n\nconst PointTypeEnum = {\n    Invalid:0,\n    Empty:1,\n    BlackChess:2,\n    WhiteChess:3,\n    DoubleChess:4,\n};\n\nconst WinOrLoseEnum = {\n    NotEndYet:0,\n    BlackWin:1,\n    WhiteWin:2,\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        ChessPrefab:cc.Prefab,\n        MessageTextPrefab:cc.Prefab,\n        RulePrefab:cc.Prefab,\n        MessageBoxPref:cc.Prefab,\n        Board:cc.Node,\n        _gameState:0,\n        GameState:{\n            get(){\n                return this._gameState;\n            },\n            set(value){\n                this._gameState = value;\n            }\n        },\n        IsBlackTurn:true,\n        ThreeTypeCount:0,\n        ChessNodes:\n        {\n            default:[],\n            visible:false,\n        },\n        HighLightThreePoints:\n        {\n            default:[],\n            visible:false,\n        },\n        NewChess:\n        {\n            default:null,\n            visible:false,\n        },\n        Notice:cc.Label,\n        ColorStr:{\n            get(){\n                if(this.IsBlackTurn)\n                {\n                    return \"蓝色\";\n                }else{\n                    return \"橙色\";\n                }\n            }\n        },\n        TurnNoticeStr:{\n            get()\n            {\n                return \"轮到\"+ this.ColorStr +\"走棋\";\n            }\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        this.Board.on(cc.Node.EventType.TOUCH_START, this.onTouchBoard, this);\n        this.Board.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        window.GameController = this;\n        window.MessageBoxPref = this.MessageBoxPref;\n        this.StartGame();\n\n    },\n    \n    StartGame()\n    {\n        this.ChessPoints = [[1,0,0,1,0,0,1],\n                            [0,1,0,1,0,1,0],\n                            [0,0,1,1,1,0,0],\n                            [1,1,1,0,1,1,1],\n                            [0,0,1,1,1,0,0],\n                            [0,1,0,1,0,1,0],\n                            [1,0,0,1,0,0,1]];\n        this.ThreePointsMap = new Map();\n        this.PointsCanMovies = new Map();//每个点的所有走法\n        for(let i=0;i<this.ChessPoints.length;i++)\n        {\n            let line = this.ChessPoints[i];\n            for(let j=0;j<line.length;j++)\n            {\n                let ptValue = line[j];\n                if(ptValue != 1)\n                {\n                    continue;\n                }\n                let pt = cc.v2(i,j);\n                if(i==0 || i==6)//第0,6行\n                {\n                    if(j==0 || j==6)\n                    {\n                        /*\n                        [2,0,0,1,0,0,2],\n                        [0,1,0,1,0,1,0],\n                        [0,0,1,1,1,0,0],\n                        [1,1,1,0,1,1,1],\n                        [0,0,1,1,1,0,0],\n                        [0,1,0,1,0,1,0],\n                        [2,0,0,1,0,0,2]\n                         */\n                        //第(0,0),(0,6)(6,0),(6,6)点\n                        let rowOffset = i==0 ? 1 : -1;\n                        let colOffset = j==0 ? 1 : -1;\n                        let oneLine = [];\n                        let lines = [];\n                        //横\n                        oneLine.push(cc.v2(i,3));\n                        oneLine.push(cc.v2(i,CENTER+3*colOffset));\n                        lines.push(oneLine);\n                        \n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(3,j));\n                        oneLine.push(cc.v2(CENTER+3*rowOffset,j));\n                        lines.push(oneLine);\n                        \n                        //斜\n                        oneLine = [];\n                        oneLine.push(cc.v2(i+1*rowOffset,j+1*colOffset));\n                        oneLine.push(cc.v2(i+2*rowOffset,j+2*colOffset));\n                        lines.push(oneLine);\n\n                        this.ThreePointsMap.set(pt,lines);\n\n                        //每个点的所有走法\n                        let moveis = [];\n                        rowOffset = i == 0 ? 1 : -1;\n                        colOffset = j == 0 ? 1 : -1;\n                        moveis.push(cc.v2(i,3));\n                        moveis.push(cc.v2(3,j));\n                        moveis.push(cc.v2(i+1*rowOffset,j+1*colOffset));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }else if(j==3)\n                    {\n                        //第(0,3),(6,3)点\n                        let rowOffset = i==0 ? 1 : -1;\n                        let oneLine = [];\n                        let lines = [];\n                        //横\n                        oneLine.push(cc.v2(i,0));\n                        oneLine.push(cc.v2(i,6));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(i+1*rowOffset,3));\n                        oneLine.push(cc.v2(i+2*rowOffset,3));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                        let moveis = [];\n                        rowOffset = i == 0 ? 1 : -1;\n                        moveis.push(cc.v2(i,0));\n                        moveis.push(cc.v2(i,6));\n                        moveis.push(cc.v2(i+1*rowOffset,3));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }\n                }\n                else if(i==1 || i==5)//第1,5行\n                {\n                    if(j==1 || j==5)\n                    {\n                        /*\n                        [1,0,0,1,0,0,1],\n                        [0,2,0,1,0,2,0],\n                        [0,0,1,1,1,0,0],\n                        [1,1,1,0,1,1,1],\n                        [0,0,1,1,1,0,0],\n                        [0,2,0,1,0,2,0],\n                        [1,0,0,1,0,0,1]\n                        */\n                        //第(1,1),(1,5),(5,1)(5,5)点\n                        let rowOffset = i == 1 ? 1 : -1;\n                        let colOffset = j == 1 ? 1 : -1;\n                        //横\n                        let oneLine = [];\n                        let lines = [];\n                        oneLine.push(cc.v2(i,3));\n                        oneLine.push(cc.v2(i,3+2*colOffset));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(3,j));\n                        oneLine.push(cc.v2(3+2*rowOffset,j));\n                        lines.push(oneLine);\n                        //斜\n                        oneLine = [];\n                        rowOffset = i == 1 ? 1 : -1;\n                        colOffset = j == 1 ? 1 : -1;\n                        oneLine.push(cc.v2(i+1*rowOffset,j+1*colOffset));\n                        oneLine.push(cc.v2(i-1*rowOffset,j-1*colOffset));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                        let moveis = [];\n                        rowOffset = i == 1 ? 1 : -1;\n                        colOffset = j == 1 ? 1 : -1;\n                        moveis.push(cc.v2(i,3));\n                        moveis.push(cc.v2(3,j));\n                        moveis.push(cc.v2(i+1*rowOffset,j+1*colOffset));\n                        rowOffset = i == 1 ? -1 : 1;\n                        colOffset = j == 1 ? -1 : 1;\n                        moveis.push(cc.v2(i+1*rowOffset,j+1*colOffset));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }else if(j==3)\n                    {\n                        /*\n                            [1,0,0,1,0,0,1],\n                            [0,1,0,2,0,1,0],\n                            [0,0,1,1,1,0,0],\n                            [1,1,1,0,1,1,1],\n                            [0,0,1,1,1,0,0],\n                            [0,1,0,2,0,1,0],\n                            [1,0,0,1,0,0,1];\n                        */ \n                        //横\n                        let oneLine = [];\n                        let lines = [];\n                        oneLine.push(cc.v2(i,1));\n                        oneLine.push(cc.v2(i,5));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(i-1,3));\n                        oneLine.push(cc.v2(i+1,3));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                        let moveis = [];\n                        moveis.push(cc.v2(i,1));\n                        moveis.push(cc.v2(i,5));\n                        moveis.push(cc.v2(i+1,3));\n                        moveis.push(cc.v2(i-1,3));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }\n                }\n                else if(i==2 || i==4)\n                {\n                    if(j==2 || j==4)\n                    {\n                        /*\n                            [1,0,0,1,0,0,1],\n                            [0,1,0,1,0,1,0],\n                            [0,0,2,1,2,0,0],\n                            [1,1,1,0,1,1,1],\n                            [0,0,2,1,2,0,0],\n                            [0,1,0,1,0,1,0],\n                            [1,0,0,1,0,0,1];\n                        */ \n                        let rowOffset = i == 2 ? 1 : -1;\n                        let colOffset = j == 2 ? 1 : -1;\n                        //横\n                        let oneLine = [];\n                        let lines = [];\n                        oneLine.push(cc.v2(i,3));\n                        oneLine.push(cc.v2(i,3+1*colOffset));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(i+1*rowOffset,j));\n                        oneLine.push(cc.v2(i+2*rowOffset,j));\n                        lines.push(oneLine);\n                        //斜\n                        oneLine = [];\n                        rowOffset = i == 2 ? -1 : 1;\n                        colOffset = j == 2 ? -1 : 1;\n                        oneLine.push(cc.v2(i+1*rowOffset,j+1*colOffset));\n                        oneLine.push(cc.v2(i+2*rowOffset,j+2*colOffset));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                        //每个点的所有走法\n                        let moveis = [];\n                        rowOffset = i == 2 ? -1 : 1;\n                        colOffset = j == 2 ? -1 : 1;\n                        moveis.push(cc.v2(i,3));\n                        moveis.push(cc.v2(3,j));\n                        moveis.push(cc.v2(i+1*rowOffset,j+1*colOffset));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }\n                    else if(j==3)\n                    {\n                        \n                        let rowOffset = i == 2 ? -1 : 1;\n                        //横\n                        let oneLine = [];\n                        let lines = [];\n                        oneLine.push(cc.v2(i,2));\n                        oneLine.push(cc.v2(i,4));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(i+1*rowOffset,3));\n                        oneLine.push(cc.v2(i+2*rowOffset,3));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                        //每个点的所有走法\n                        let moveis = [];\n                        rowOffset = i == 2 ? -1 : 1;\n                        moveis.push(cc.v2(i,2));\n                        moveis.push(cc.v2(i,4));\n                        moveis.push(cc.v2(i+1*rowOffset,3));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }\n                }\n                else if(i==3)\n                {\n                    if(j==0 || j==6)\n                    {\n                        let colOffset = j == 0 ? 1 : -1;\n                        //横\n                        let oneLine = [];\n                        let lines = [];\n                        oneLine.push(cc.v2(3,j+1*colOffset));\n                        oneLine.push(cc.v2(3,j+2*colOffset));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(0,j));\n                        oneLine.push(cc.v2(6,j));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                        //每个点的所有走法\n                        let moveis = [];\n                        colOffset = j == 0 ? 1 : -1;\n                        moveis.push(cc.v2(0,j));\n                        moveis.push(cc.v2(6,j));\n                        moveis.push(cc.v2(3,j+1*colOffset));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }else if(j==1 || j==5)\n                    {\n                        /*\n                            [1,0,0,1,0,0,1],\n                            [0,1,0,1,0,1,0],\n                            [0,0,1,1,1,0,0],\n                            [1,2,1,0,1,2,1],\n                            [0,0,1,1,1,0,0],\n                            [0,1,0,1,0,1,0],\n                            [1,0,0,1,0,0,1];\n                        */ \n                        //横\n                        let oneLine = [];\n                        let lines = [];\n                        oneLine.push(cc.v2(3,j-1));\n                        oneLine.push(cc.v2(3,j+1));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(1,j));\n                        oneLine.push(cc.v2(5,j));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                        //每个点的所有走法\n                        let moveis = [];\n                        moveis.push(cc.v2(3,j-1));\n                        moveis.push(cc.v2(3,j+1));\n                        moveis.push(cc.v2(i-2,j));\n                        moveis.push(cc.v2(i+2,j));\n                        this.PointsCanMovies.set(pt,moveis);\n                    }else if(j==2 || j==4)\n                    {\n/*\n                            [1,0,0,1,0,0,1],\n                            [0,1,0,1,0,1,0],\n                            [0,0,1,1,1,0,0],\n                            [1,1,2,0,2,1,1],\n                            [0,0,1,1,1,0,0],\n                            [0,1,0,1,0,1,0],\n                            [1,0,0,1,0,0,1];\n                        */ \n                        //横\n                        let colOffset = j==2 ? -1 : 1;\n                        let oneLine = [];\n                        let lines = [];\n                        oneLine.push(cc.v2(3,j+1*colOffset));\n                        oneLine.push(cc.v2(3,j+2*colOffset));\n                        lines.push(oneLine);\n                        //竖\n                        oneLine = [];\n                        oneLine.push(cc.v2(2,j));\n                        oneLine.push(cc.v2(4,j));\n                        lines.push(oneLine);\n                        this.ThreePointsMap.set(pt,lines);\n\n                         //每个点的所有走法\n                         let moveis = [];\n                         colOffset = j == 2 ? -1 : 1;\n                         moveis.push(cc.v2(3,j+1*colOffset));\n                         moveis.push(cc.v2(i-1,j));\n                         moveis.push(cc.v2(i+1,j));\n                         this.PointsCanMovies.set(pt,moveis);\n                    }\n                }\n            }\n        }\n\n        console.log(\"所有点的成三点\",this.ThreePointsMap);\n        console.log(\"点的所有可移动点\",this.PointsCanMovies);\n        //console.log(this.ThreePointsMap);\n        this.ResetGame();\n        this.GameState = GameStateEnum.DropChess;\n\n        this.ShowMessage(this.TurnNoticeStr);\n    },\n    ResetGame()\n    {\n        if(this.ChessNodes.length >0)\n        {\n            this.ChessNodes.forEach(node=>{\n                node.destroy();\n            })\n        }\n        this.ChessNodes = [];\n        this.NewChess = null;\n    },\n    StartButtonClick()\n    {\n        this.StartGame();\n    },\n    test(){\n        MessageBox.show(\"蓝色赢了\",MessageBox.OK)\n    },\n    Point2Position(pt)\n    {\n        //棋盘上某个交叉点的坐标为: \n        //x坐标=(交叉点的列索引-3)*width,\n        //y坐标=(3-交叉点的行索引)*width\n        let pos = cc.v2((pt.y-3)*width,(3-pt.x)*width);\n        return pos;\n    },\n   \n    onTouchBoard(event){\n        if(this.GameState == GameStateEnum.None)\n        {\n            return;\n        }\n    },\n    onTouchEnd(event)\n    {\n        if(this.GameState != GameStateEnum.DropChess && \n            this.GameState != GameStateEnum.PressChess &&\n            this.GameState != GameStateEnum.MoveChess)\n        {\n            return;\n        }\n        let pos = event.getLocation();\n        const worldPos = this.node.parent.convertToWorldSpaceAR(pos);\n        const localPos = this.Board.convertToNodeSpaceAR(worldPos);\n        //落子状态\n        if(this.GameState == GameStateEnum.DropChess)\n        {\n            //落子\n            let pt = this.CheckPosInPoint(localPos,PointTypeEnum.Empty);\n            if(pt != null)\n            {\n                let chess = cc.instantiate(this.ChessPrefab);\n                chess.parent = this.Board;\n                let pos = this.Point2Position(pt);\n                chess.position = pos;\n                chess.getComponent('Chess').InitChess(this.IsBlackTurn,true);\n                chess.getComponent('Chess').Point = pt;\n                this.ChessNodes.push(chess);\n                this.ChessPoints[pt.x][pt.y] = this.IsBlackTurn ? PointTypeEnum.BlackChess : PointTypeEnum.WhiteChess;\n                \n                if(this.NewChess != null)\n                {\n                    this.NewChess.IsCurrentFlag=false;\n                }\n                this.NewChess = chess.getComponent('Chess');\n\n\n                this.CheckThree(pt);\n                if(this.ThreeTypeCount > 0)//成三了\n                {\n                    this.GameState = GameStateEnum.PressChess;\n                    \n                }else{\n                    this.IsBlackTurn = !this.IsBlackTurn;\n                    this.ShowMessage(this.TurnNoticeStr);\n                    this.CheckDropPhaseFinish();\n                }\n            }\n            \n            return;\n        }\n        //压子状态\n        else if(this.GameState == GameStateEnum.PressChess)\n        {\n            if(this.ThreeTypeCount>0)\n            {\n                let type = this.IsBlackTurn ? PointTypeEnum.WhiteChess : PointTypeEnum.BlackChess;\n                let pt2 = this.CheckPosInPoint(localPos,type);\n                if(pt2 != null)\n                {\n                    this.ThreeTypeCount--;\n                    this.ChessPoints[pt2.x][pt2.y] = PointTypeEnum.DoubleChess;\n                    for(let i=0;i<this.ChessNodes.length;i++)\n                    {\n                        let chess = this.ChessNodes[i];\n                        let tempPt = chess.getComponent('Chess').Point;\n                        if(tempPt.x == pt2.x && tempPt.y == pt2.y)\n                        {\n                            let newChess = cc.instantiate(this.ChessPrefab);\n                            newChess.parent = this.Board;\n                            newChess.getComponent('Chess').Point = pt2;\n                            newChess.getComponent('Chess').InitChess(this.IsBlackTurn,false);\n                            newChess.position = this.Point2Position(pt2);\n                            if(pt2.x == 3)\n                            {\n                                newChess.y += 8;\n                                chess.y -=8;\n                            }\n                            else{\n                                newChess.x += 8;\n                                chess.x -=8;\n                            }\n                            \n                            this.ChessNodes.push(newChess);\n                            break;\n                        }\n                    }\n                    if(this.ThreeTypeCount > 0)\n                    {\n                        let msg = this.ColorStr+\"还可以吃对方\"+this.ThreeTypeCount+\"个子\";\n                        this.ShowMessage(msg);\n                    }\n                    \n                }\n                \n            }\n            if(this.ThreeTypeCount == 0)\n            {\n                if(this.HighLightThreePoints.length>0)\n                {\n                    this.HighLightChesses(false);\n                    this.HighLightThreePoints = [];\n                }\n                if(this.NewChess != null)\n                {\n                    this.NewChess.IsCurrentFlag=false;\n                }\n                this.GameState = GameStateEnum.DropChess;\n                this.IsBlackTurn = !this.IsBlackTurn;\n                this.ShowMessage(this.TurnNoticeStr);\n            }\n            this.CheckDropPhaseFinish();\n        }\n        else if(this.GameState == GameStateEnum.MoveChess)\n        {\n            let point = this.CheckPosInPoint(localPos,CommonDefine.PointTypeEnum.Empty);\n            if(point != null)//坐标点落在某个棋盘点上且该棋盘点上无子\n            {\n                let bCanMove = this.CheckCanMoveTo(this.NewChess.Point,point);\n                if(bCanMove)//该棋盘点是当前棋子的合法行走点\n                {\n                    let centerPos = this.Point2Position(point);\n                    this.NewChess.node.runAction(cc.moveTo(0.3,centerPos));\n                    let prePt = cc.v2(this.NewChess.Point.x,this.NewChess.Point.y);\n                    this.NewChess.Point = point;\n                    this.AfterMoveTo(prePt,point);\n                }\n            }\n        }\n\n    },\n    CheckPosInPoint(pressPos,needPointType){\n        let pt = null;\n        console.log(\"CheckPosInPoint,pressPos=\",pressPos);\n        for(let i=0;i<this.ChessPoints.length;i++)\n        {\n            let line = this.ChessPoints[i];\n            for(let j=0;j<line.length;j++)\n            {\n                let ptValue = line[j];\n                if(ptValue == needPointType)\n                {\n                    let ptPos = this.Point2Position(cc.v2(i,j));\n                    //判断触摸点是否在棋盘某个交叉点上\n                    console.log(\"x=\",i,\",y=\",j);\n                    if((Math.abs(ptPos.x - pressPos.x) <= width/2) && (Math.abs(ptPos.y - pressPos.y) <= width/2))\n                    {\n                        pt = cc.v2(i,j);\n                        //console.log(this.ChessPoints);\n                        return pt;\n                    }\n                }\n            }\n        }\n        return pt;\n    },\n    CheckCanMoveTo(srcPoint, dstPoint)\n    {\n        let movies = null;\n        this.PointsCanMovies.forEach((value,key)=>{\n            if(srcPoint.x == key.x && srcPoint.y == key.y)\n            {\n                movies = value;\n            }\n        });\n        if(movies==null || movies.length == 0)\n        {\n            return false;\n        }\n        for(let i=0;i<movies.length;i++)\n        {\n            if(movies[i].x == dstPoint.x && movies[i].y==dstPoint.y)\n            {\n                return true;\n            }\n        }\n        return false;\n    },\n    AfterMoveTo(srcPoint,dstPoint)\n    {\n        this.ChessPoints[dstPoint.x][dstPoint.y] = this.ChessPoints[srcPoint.x][srcPoint.y];\n        this.ChessPoints[srcPoint.x][srcPoint.y] = CommonDefine.PointTypeEnum.Empty;\n        //判断走棋后是否成三\n        let threeTypeCount = this.CheckThree(dstPoint);\n        if(threeTypeCount > 0)\n        {\n            this.GameState = CommonDefine.GameStateEnum.EatChess;\n        }else{\n            this.IsBlackTurn = !this.IsBlackTurn;\n        }\n    },\n    CheckThree(point)\n    {\n        let threeTypeCount = 0;\n        this.ThreePointsMap.forEach((value, key)=>{\n            if(point.x == key.x && point.y == key.y)\n            {\n                let lines = value;\n                //检查该点的横，竖，斜线方向的点是否形成一个“三”\n                lines.forEach(oneLine=>{\n                    let sameChessNum = 0;\n                    oneLine.forEach(pt=>{\n                        let ptValue = this.ChessPoints[pt.x][pt.y];\n                        //console.log(\"CheckThree pt.x=\",pt.x,\",pt.y=\",pt.y);\n                        if(ptValue == PointTypeEnum.BlackChess || \n                            ptValue == PointTypeEnum.WhiteChess)\n                        {\n                            if(ptValue == this.ChessPoints[point.x][point.y]){\n                                sameChessNum++;\n                            }\n                        }\n                    });\n                    if(sameChessNum == oneLine.length)\n                    {\n                        threeTypeCount++;\n                        oneLine.forEach(pt=>{\n                            if(this.HighLightThreePoints.indexOf(pt) == -1)\n                            {\n                                this.HighLightThreePoints.push(pt);\n                            }\n                        });\n                    }\n                });\n                \n            }\n        });\n        \n        if(this.HighLightThreePoints.length>0)\n        {\n            this.HighLightThreePoints.push(point);\n            this.HighLightChesses(true);\n        }\n        this.ThreeTypeCount = threeTypeCount;\n        if(threeTypeCount > 0)\n        {\n            let msg = this.ColorStr+\"形成了\"+ this.ThreeTypeCount + \"个三子,可以吃掉对方\"+this.ThreeTypeCount+\"个棋子\";\n            this.ShowMessage(msg);\n        } \n        return threeTypeCount;\n    },\n    HighLightChesses(isFlash)\n    {\n        if(!this.HighLightThreePoints || this.HighLightThreePoints.length <=0)\n        {\n            return;\n        }\n        this.HighLightThreePoints.forEach(pt=>{\n            this.ChessNodes.forEach(node=>{\n                let chess = node.getComponent('Chess');\n                if(chess.Point.x == pt.x && chess.Point.y == pt.y)\n                {\n                    if(isFlash)\n                    {\n                        chess.Flash();\n                    }else{\n                        chess.StopFlash();\n                    }\n                    \n                }\n            })\n        });\n    },\n    CheckDropPhaseFinish()\n    {\n        if(this.IsBoardFull())\n        {\n            for(let i=0;i<this.ChessPoints.length;i++)\n            {\n                for(let j=0;j<this.ChessPoints[i].length;j++)\n                {\n                    let ptValue = this.ChessPoints[i][j];\n                    let point = cc.v2(i,j);\n                    //删除成对的子\n                    if(ptValue == 4)\n                    {\n                        this.ChessPoints[i][j] = 1;\n                        for(let k=0;k<this.ChessNodes.length;k++)\n                        {\n                            let chess = this.ChessNodes[k];\n                            let tempPt = chess.getComponent('Chess').Point;\n                            if(tempPt.x == point.x && tempPt.y == point.y)\n                            {\n                                this.ChessNodes.delete(chess);\n                                chess.destroy();\n                            }\n                        }\n                    }\n                }\n            }\n            this.GameState = GameStateEnum.MoveChess;\n            this.IsBlackTurn = false;//摆棋阶段黑子先布子，则动子白子先动子\n            this.ShowMessage(this.TurnNoticeStr);\n        }\n    },\n    IsBoardFull()\n    {\n        for(let i=0;i<this.ChessPoints.length;i++)\n        {\n            for(let j=0;j<this.ChessPoints[i].length;j++)\n            {\n                let ptValue = this.ChessPoints[i][j];\n                if(ptValue == 1)\n                {\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n    EatChess(chessNode){\n        if(this.GameState != CommonDefine.GameStateEnum.EatChess)\n        {\n            return;\n        }\n        let pt = chessNode.getComponent('Chess').Point;\n        this.ChessPoints[pt.x][pt.y] = CommonDefine.PointTypeEnum.Empty;\n        this.ChessNodes.delete(chessNode);\n        chessNode.destroy();\n        let endStatus = this.JudgeWin();\n        if(endStatus != WinOrLoseEnum.NotEndYet)\n        {\n            return;\n        }\n        this.ThreeTypeCount--;\n        if(this.ThreeTypeCount > 0)\n        {\n            let msg = this.ColorStr+\"还可以吃对方\"+this.ThreeTypeCount+\"个子\";\n            this.ShowMessage(msg);\n        }else{\n            if(this.HighLightThreePoints.length>0)\n            {\n                this.HighLightChesses(false);\n                this.HighLightThreePoints = [];\n            }\n            this.IsBlackTurn = !this.IsBlackTurn;\n            this.ShowMessage(this.TurnNoticeStr);\n            this.GameState = CommonDefine.GameStateEnum.MoveChess;\n        }\n\n    },\n    JudgeWin()\n    {\n        let blackCount = 0;\n        let wihteCount = 0;\n        this.ChessNodes.forEach(node=>{\n            let chess = node.getComponent('Chess');\n            if(chess.IsBlack){\n                blackCount++;\n            }else{\n                wihteCount++\n            }\n        });\n        let status = WinOrLoseEnum.NotEndYet;\n        if(blackCount <= 2)\n        {\n            let msg = \"橙色方赢了\";\n            MessageBox.show(msg,MessageBox.OK)\n            status = WinOrLoseEnum.WhiteWin;\n        }\n        else if(wihteCount <= 2)\n        {\n            let msg = \"蓝色方赢了\";\n            MessageBox.show(msg,MessageBox.OK)\n            status = WinOrLoseEnum.BlackWin;\n        }\n        if(status != WinOrLoseEnum.NotEndYet)\n        {\n            this.GameState = CommonDefine.GameStateEnum.GameEnd;\n        }\n        return status;\n    },\n    ShowMessage(msg)\n    {\n        this.Notice.string = msg;\n        // let messageText = cc.instantiate(this.MessageTextPrefab);\n        // messageText.parent = this.node;\n        // messageText.getComponent('MessageText').setMsg(msg,3);\n    },\n\n    OnRuleBtnClick()\n    {\n        let rule = cc.instantiate(this.RulePrefab);\n        rule.parent = this.node;\n    }\n\n});\n"]}